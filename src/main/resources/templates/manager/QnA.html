<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header::head('관리자 페이지')}"></head>
<style>
	.manager{
		margin-top: 170px;
	}

	.wrap {
		text-align: center;
	}
	
	.qna{
		text-align: left;
	}
	
	.blind{
		display: none;		/* 완전히 화면에서 없애버린다. */
	}
	
	
</style>

<script th:inline="javascript">

	$(function(){
		
	  	// 원글 달기 결과 메시지
	    let addResult = /*[[${addResult}]]*/ null;  // addResult가 전달되지 않는 경우 null을 사용한다.
	    if(addResult !== null){
	      if(addResult === 2) {
	        alert('원글이 달렸습니다.');
	      } else {
	        alert('원글 달기가 실패했습니다.');
	      }
	    }
		
	 	// 게시글 삭제 결과 메시지
	    let removeResult = /*[[${removeResult}]]*/ null;  // removeResult가 전달되지 않는 경우 null을 사용한다.
	    if(removeResult !== null){
	      if(removeResult === 1) {
	        alert('게시글이 삭제되었습니다.');
	      } else {
	        alert('게시글 삭제가 실패했습니다.');
	      }
	    }
		
	 	// 답글 달기 결과 메시지
	    let updateResult = /*[[${updateResult}]]*/ null;  // addReplyResult가 전달되지 않는 경우 null을 사용한다.
	    if(updateResult !== null){
	      if(updateResult === 1) {
	        alert('답글이 달렸습니다.');
	      } else {
	        alert('답글 달기가 실패했습니다.');
	      }
	    }
		
		// 삭제 버튼 이벤트
		$('.frm_remove').on('submit', function(ev){
			if(confirm('BBS를 삭제할까요?') == false){
				ev.preventDefault();
				return;
			}
		})
		
		// 답글 작성 화면 표시/숨기기
		$('.btn_answer').on('click', function(){
			// 작성화면
			let write = $(this).closest('.list').next();  // write는 jQuery객체이다. (jQuery wrapper가 필요 없다.)
			// 작성화면이 blind를 가지고 있다 = 다른 작성화면이 열려 있다
			if(write.hasClass('blind')){
				
				$('.write').addClass('blind');  // 모든 작성화면을 닫자
				write.removeClass('blind');     // 현재 작성화면을 열자
			// 작성화면이 blind를 가지고 있지 않다 = 현재 작성화면이 열려 있다
			} else {
				write.addClass('blind');        // 현재 작성화면을 닫자
			}
			
		})
		
		$('.btn_reply').on('click', function(){
			// 작성화면
			let answer = $(this).closest('.list').next().next();  // write는 jQuery객체이다. (jQuery wrapper가 필요 없다.)
			// 작성화면이 blind를 가지고 있다 = 다른 작성화면이 열려 있다
			if(answer.hasClass('blind')){
				
				$('.answer').addClass('blind');  // 모든 작성화면을 닫자
				answer.removeClass('blind');     // 현재 작성화면을 열자
			// 작성화면이 blind를 가지고 있지 않다 = 현재 작성화면이 열려 있다
			} else {
				answer.addClass('blind');        // 현재 작성화면을 닫자
			}
			
		})
		
	})
</script>

<body>

	
	<div th:replace="~{layout/header::gnb}"></div>
	
	<div class="wrap">
		<a th:href="@{/manager/writeQna.html}" id="QnaList">작성하기</a> 
		<h1>1:1 문의</h1>
		<div th:utext="${pagination}"></div>
		<th:block th:each="qna,vs:${qnaList}">
			<hr>
			<div class="qna list">
				<div>
					<span th:text="${qna.userDTO.userId}"></span>
					<span th:text="${qna.title}"></span>
					<br>
					<br>
					<div>
						<th:block th:if="${qna.qnaState == 1}"><span>!!!</span> </th:block>
						<br>
						<span><input type="button" value="답변 보기" class="btn_reply"> </span>
						<th:block th:if="${qna.qnaState == 2}">
							<span><input type="button" value="답변 수정하기" class="btn_answer"> </span>
						</th:block>
						<th:block th:if="${qna.qnaState == 1}">
							<span><input type="button" value="답변 달기" class="btn_answer"> </span>
						</th:block>
						<!-- <th:block th:if="${session.loginId == bbs.writer}"> -->
							<form class="frm_remove" method="post" th:action="@{/manager/remove.do}">
								<input type="hidden" name="qnaNo" th:value="${qna.qnaNo}">
								<button>삭제</button>
							</form>
						<!-- </th:block> -->
					</div>
				</div>
			</div>
			<div class="write blind">
				<form method="post" th:action="@{/manager/answer.do}">
					<div>
						<label for="answer">답변</label>
						<br>
						<textarea rows="10" cols="50" id="answer" name="answer" placeholder="답변 내용을 입력해주세요" required="required"></textarea>
						<input type="hidden" name="qnaNo" th:value="${qna.qnaNo}">
						<input type="hidden" name="depth" th:value="${qna.depth + 1}">
						<input type="hidden" name="groupNo" th:value="${qna.groupNo}">
						<button>답변달기</button>
					</div>
				</form>
			</div>
			<div class="answer blind">
				<th:block th:if="${qna.qnaState == 2}">
					<span>관리자 : </span>
					<span th:text="${qna.answer}"></span>
					<br>
					<span th:text="${qna.answerAt}"></span>
				</th:block>
				<th:block th:if="${qna.qnaState == 1}">
					<span>아직 답변이 달리지 않았습니다.</span>
				</th:block>
			</div>
		</th:block>
		<hr>
	</div>

  	
  	

</body>
</html>